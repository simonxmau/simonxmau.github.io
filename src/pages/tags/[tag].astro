---
import  {CollectionEntry,getCollection} from "astro:content";
import Layout from '@layouts/Layout';
import Preview from "@components/Preview";

export async function getStaticPaths() {
	const posts = await getCollection("blog");

	// const tags = getUniqueTags(posts);
	const uniqueTags = [...new Set(posts.map((post) => post.data.tags).flat())];

	return uniqueTags.map((tag) => {
		const filteredPosts = posts.filter((post) => post.data.tags && post.data.tags.includes(tag));
		return {
			params: { tag },
			props: { posts: filteredPosts },
		};
	});
}

const { tag } = Astro.params;
const { posts } = Astro.props;

---
<Layout>
	<div class="post-header container">
		<h1 class="post-title">包含「{tag}」标签的文章</h1>
	</div>
	<div class="content container">
		{posts.map((p) => <Preview post={p} />)}
	</div>
</Layout>


<style>
	.post-header {
		margin-top: 60px;
		margin-bottom: 40px;
	}
	.post-date {
		font-size: 0.75rem;
	}

	.content {
		margin-bottom: 40px;
	}
</style>